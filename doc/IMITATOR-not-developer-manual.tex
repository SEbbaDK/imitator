%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% UNCOMMENT THE LINE BELOW TO VIEW COMMENTS
% \def\DraftVersion {}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% TITLE TO BE PRINTED ON THE HEADERS
\newcommand{\titleOnHeader}{\textsf{IMITATOR} \emph{not} a Developer Manual}

% TITLE TO BE PRINTED ON THE FIRST PAGE
\newcommand{\titleOnFirstPage}{IMITATOR \emph{not} a Developer Manual}

\input{commons.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% META DATA
\hypersetup{
	pdftitle={IMITATOR Developer Manual},
	pdfauthor={\'Etienne Andr\'e}%
}
\title{IMITATOR Developer Manual}
\author{Étienne André}
	


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
% \maketitle


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{title_and_toc.tex}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\imitator{}~\cite{AFKS12} has no developer manual, for many (mainly bad) reasons:
lack of time, small team of developers with strong interactions, little concurrent development.

Nevertheless, this document tries (or will try) to summarize some of the important internal characteristics of \imitator{}.
It will naturally evolve over time.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Parsing process}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


Since version 3.0, the parsing process is as follows:

\begin{enumerate}
	\item Get the options from the terminal command
	\item Parse the model
	\item Depending on the option (notably, the presence or not of a \styleOption{-mode}, that triggers translation or syntax check instead of looking for a property), decide whether a property should be parsed or not; if so, parse the property
	\item Check and convert to abstract structures at the same time both the model and the property (if any)
\end{enumerate}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Constraint representation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Constraints are implemented using the Parma Polyhedra Library (PPL)~\cite{BHZ08}.
Constraints in PPL use integer-valued indexes for variables.

In \imitator{}, the variables are numbered as follows in the constraint, starting from~0:
\begin{itemize}
	\item first the parameters
	\item then the regular clocks in the model
	\item then the observer clock (if any), automatically inferred from the property (if any)
	\item then the extra reset clock (mainly used to measure time elapsing in non-Zeno checking)
	\item then all discrete variables.
\end{itemize}

% TODO: dessin avec les variables et une accolade dessous montrant les indices



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{State computation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


Here is a tentative scheme to compute the successor of a symbolic state.
The idea is to first compute as many things on the \emph{discrete} side, as it is computationally cheap, as opposed to \emph{continuous} constraints encoded in~PPL.

\begin{enumerate}
	\item collect and evaluate the discrete parts of the guards; if unsatisfiable, stop
	\item compute the successor location, including the updated discrete variables;
	\item collect and evaluate the discrete parts of the target invariants; if unsatisfiable, stop
	\item collect and evaluate the continuous part of the guards; if unsatisfiable, stop
	\item collect and evaluate the continuous part of the target invariants; if unsatisfiable, stop
\end{enumerate}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Algorithms class diagrams}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We give below the class diagram of the non-distributed algorithms implemented in \imitator{} below.
Virtual classes are depicted in yellow.


\includegraphics[width=\textwidth]{classDiagramSimplified.png}



The full class diagram of all algorithm classes (included distributed algorithms) is given in the next page.

\newenvironment{changemargin}[2]{%
\begin{list}{}{%
\setlength{\topsep}{0pt}%
\setlength{\leftmargin}{#1}%
\setlength{\rightmargin}{#2}%
\setlength{\listparindent}{\parindent}%
\setlength{\itemindent}{\parindent}%
\setlength{\parsep}{\parskip}%
}%
\item[]}{\end{list}}

\newpage
\begin{landscape}
% \newgeometry{left=3cm,bottom=0.1cm}
\begin{changemargin}{-2.cm}{-3cm}
\thispagestyle{empty}
\includegraphics[width=2.3\textwidth]{classDiagramFull.png}
\end{changemargin}
\end{landscape}
\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Licensing and Credits}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection*{Developer Manual}
This developer manual is available under the Creative Commons CC-BY-SA license.

\begin{center}
	\includegraphics[width=.2\textwidth]{images/CC-BY-SA_500.png}
\end{center}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{graphics-credits.tex}

\input{bibliography.tex}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




\end{document}

